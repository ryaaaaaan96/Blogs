
# 1 希尔伯特变换

对于ADAU的输入1是信号，输出1是原信号，输出2是虚部信号；
解调瞬时幅度（就是解调值）是通过输出1和输出2平方开根号得到幅度
瞬时相位通过atan2对虚部和实部进行计算

###### 希尔伯特变换的定义

对于一个实数信号 \( x(t) \)，其希尔伯特变换 \( y(t) \) 可以通过以下积分来定义：
\[ y(t) = \frac{1}{\pi} \int_{-\infty}^{t} \frac{x(\tau)}{t - \tau} d\tau \]
这里，\( y(t) \) 是 \( x(t) \) 的希尔伯特变换，它是一个因果系统，只与过去和现在的值有关。

###### 解析信号

解析信号 \( x_a(t) \) 是原始实数信号 \( x(t) \) 和其希尔伯特变换 \( y(t) \) 的和：
\[ x_a(t) = x(t) + j y(t) \]
其中，\( j \) 是虚数单位。

解析信号具有以下特性：
- 它是一个复数信号。
- 它的频谱是对称的，所有频率成分都位于正频率部分。
###### 应用

1. **瞬时频率和相位**：通过解析信号，可以定义瞬时频率和瞬时相位，这对于分析信号的局部特性非常有用。
2. **调制和解调**：在通信系统中，希尔伯特变换用于调制和解调信号。（AM瞬时幅值就是原始信号强度，）
3. **滤波**：在某些滤波器设计中，希尔伯特变换可以用于生成具有特定相位特性的滤波器。

###### 数字实现

在数字信号处理中，希尔伯特变换可以通过离散时间信号处理技术来实现。一种常见的方法是使用离散傅里叶变换（DFT）和其逆变换（IDFT）：

1. 对原始信号进行DFT。
2. 在频域中，将所有负频率成分设置为零，保留正频率成分。
3. 将正频率成分乘以 \( e^{j\pi/2} \)（即90度相位偏移）。
4. 对结果进行IDFT，得到解析信号。

这种方法在数字信号处理中非常有效，尤其是在实现带通滤波器和解调器时。

希尔伯特变换是信号处理中的一个重要工具，它可以帮助我们更深入地理解信号的特性和行为。

# 2 滤波（）
#滤波
## 2.1 FIR滤波
FIR（Finite Impulse Response，有限冲激响应）滤波器是一种在数字信号处理中广泛使用的滤波器类型。下面是FIR滤波器的原理、特点和应用的详细说明：

###### FIR滤波器原理：

1. **卷积运算**：FIR滤波器通过将输入信号与一系列滤波器系数进行卷积运算来生成输出信号。如果滤波器有 NN 个系数，输出信号 y[n]y[n] 可以表示为： y[n]=b0⋅x[n]+b1⋅x[n−1]+…+bN−1⋅x[n−N+1]<br>其中，x[n]x[n] 是输入信号，bkbk​ 是滤波器系数。
2. **线性相位**：由于FIR滤波器是线性的，并且其系数决定了相位响应，所以可以设计具有线性相位特性的FIR滤波器，这对于保持信号波形的完整性非常重要。
3. **频率响应**：FIR滤波器的频率响应是其系数的离散傅里叶变换（DTFT）。

###### FIR滤波器特点：
1. **稳定性**：FIR滤波器是无条件稳定的，因为它们不包含反馈环节。
2. **因果系统**：FIR滤波器是因果系统，意味着输出只在输入信号到达之后产生。
3. **易于设计**：与IIR（无限冲激响应）滤波器相比，FIR滤波器的设计通常更简单直观。
4. **灵活性**：可以通过改变系数来轻松调整滤波器的特性。
5. **无振荡**：由于没有反馈，FIR滤波器不会产生振荡。
6. **相位特性**：可以设计具有线性相位的FIR滤波器，这对于某些应用（如通信系统）非常重要。
7. **滤波器长度**：滤波器的长度决定了其性能，包括过渡带宽度和滤波器的延迟。
8. **计算复杂度**：FIR滤波器的计算量与滤波器的长度成正比。

###### FIR滤波器应用：
1. **音频处理**：用于均衡器、降噪、回声消除等。
2. **图像处理**：用于图像增强、锐化、模糊等。
3. **通信系统**：用作抗混叠滤波器和匹配滤波器。
4. **仪器和控制系统**：用于信号调理和噪声抑制。
5. **生物医学信号处理**：如心电图（ECG）和脑电图（EEG）信号分析。
6. **视频处理**：用于视频压缩和传输中的滤波。
7. **数字电视和广播**：用于信号的预处理和后处理。
8. **自适应滤波**：在某些应用中，FIR滤波器的系数可以自适应地调整以优化性能。

###### FIR滤波器的设计思路：
使用matlab的Filter设计工具

FIR滤波器设计方法主要有窗函数法、线性最小均方差法、最大似然法、自适应滤波法、线性预测法等。窗函数法是一种简单的设计方法，它可以通过选择合适的窗函数来实现滤波器的设计；而线性最小均方差法则是一种更加复杂的设计方法，它可以通过最小化滤波器的均方差来实现滤波器的设计。最大似然法可以通过最大化滤波器的似然函数来实现滤波器的设计；自适应滤波法可以通过自适应的方式来实现滤波器的设计；线性预测法可以通过线性预测的方式来实现滤波器的设计。






FIR滤波器由于其稳定性和设计上的灵活性，成为了许多数字信号处理应用的首选。然而，设计高性能的FIR滤波器可能需要较长的滤波器长度，这可能导致较高的计算成本和延迟。在实际应用中，需要在性能和资源消耗之间做出权衡。

## 2.2 EQ模块
### Paramtric EQ 模块功能：

- **扩展功能**：Parametric EQ 模块扩展了通用二阶滤波器的功能，提供了一个增强的图形滤波器设计工具。
- **多级联接**：允许多个二阶滤波器级联，以创建复杂的滤波器响应，最多可以级联15个二阶滤波器。

### 提供的特性：

- **图形设计**：提供滤波器响应曲线的图形设计。
- **高阶滤波**：通过级联的二阶滤波器实现高阶滤波。
- **独立设置**：每个滤波器阶段都有独立的滤波器类型和设置。

### 模块实现：

- 该模块使用级联的双二阶滤波器（biquad filters）实现。有关双二阶滤波器设计技术的详细信息，可以参考“General 2nd-Order Filters”（通用二阶滤波器）部分。

### 使用方法：

- **滤波器控制窗口**：初始时显示单个滤波器控制，用户可以通过点击图标按钮打开滤波器控制窗口。
- **添加滤波器阶段**：通过点击“Add Filter”（添加滤波器）按钮，可以添加更多的滤波器阶段，最多15个。要移除滤波器，可以选择图形中的滤波器或点击滤波器列中的索引，然后按“Remove Filter”（移除滤波器）按钮。

### 控制项：

- **图形控制**：每个滤波器的响应可以通过图形控制或底部的旋转控制独立调整。
- **调整特性**：通过点击滤波器图形上的彩色圆圈并拖动到理想位置，可以改变滤波器的特性，如“Frequency”（频率）或“Boost”（增益）。也可以直接通过旋转控制更改参数。
- **调整Q因子**：通过点击彩色圆圈上方的水平线控制，并左右拖动，调整滤波器的带宽。
- **选择滤波器类型**：在“Type”（类型）列中，可以选择低通、高通、峰值、音调、IIR（无限冲激响应）和一阶滤波器。
- **子类型**：仅在一阶滤波器类型下可用。在一阶模式下，可以选择两种级联的一阶滤波器的组合方式，如低通-低通、低通-高通、高通-低通或高通-高通。
- **激活设置**：“Active 1”和“Active 2”复选框仅适用于一阶滤波器，允许独立启用或禁用两个一阶滤波器。
- **旁路功能**：选中“Bypass”（旁路）复选框可以禁用滤波器。

### 界面设置：

- **视图修改**：通过更改频率和幅度设置，可以修改绘图视图。这些设置仅适用于界面，不影响滤波器的实际响应。

总的来说，Parametric EQ 模块是一个强大的音频处理工具，允许用户通过图形界面设计和调整滤波器响应，以满足特定的音频处理需求。
## 2.3 二阶滤波模块（Biquad 滤波器）
1. **滤波器类型**：
    - 该模块提供了多种二阶（双二阶）滤波器算法，包括参数均衡（Parametric）、搁架（Shelving）、通用高通、通用低通、通用带通、通用带阻、巴特沃斯（Butterworth）、贝塞尔（Bessel）、Tone Control、IIR Coefficient、一阶低通/高通、全通（All-pass）、峰值（Peaking）、陷波（Notch）和切比雪夫（Chebyshev）滤波器。
2. **系数计算**：
    - 滤波器系数的计算发生在控制器中，而不是在 DSP 上。
3. **图形用户界面（GUI）控制**：
    - 用户可以通过 GUI 控件选择滤波器类型、截止频率、增益、Q 因子等参数。
4. **滤波器系数**：
    - 滤波器的传递函数通常表示为 H(z)=b0+b1z−1+b2z−21+a1z−1+a2z−2H(z)=1+a1​z−1+a2​z−2b0​+b1​z−1+b2​z−2​。
    - 系数 b0b0​, b1b1​, b2b2​ 是滤波器的喂入项，而 a1a1​, a2a2​ 是滤波器的反馈项。
5. **系数存储**：
    - 所有系数都除以 a0a0​ 进行归一化，使得 a0=1a0​=1，这样只需要存储5个系数。
6. **系数写入 DSP**：
    - 在实际的 DSP 实现中，当系数存储在参数 RAM 中时，a1a1​ 和 a2a2​ 需要被反转。SigmaStudio 软件在将参数写入 DSP 存储器之前会自动执行此操作。
7. **Q 因子**：
    - 默认情况下，Q 因子的值根据经典的电子工程定义进行了调整，以便对于相同的 Q 和 f0/Fsf0​/Fs​，增益提升 N dB 后跟一个 N dB 的削减，结果是一个完全平坦的增益滤波器或“导线”。
8. **滤波器配置**：
    - 可以选择性地禁用不使用的滤波器，并通过右键单击模块并选择“Configure Supported Filters”来选择只使用所需的滤波器。
9. **DSP 参数信息**：
    - 文本还提供了 GUI 控件名称和编译器名称的映射，以及它们的功能描述。
10. **滤波器系数的校正**：
    - 文本中提到了在某些情况下，如巴特沃斯和贝塞尔高通滤波器，b0b0​ 和 b2b2​ 的负号是错误的，它们不应该被包含在内。

这个模块是 ADAU1701 音频处理器中用于音频信号处理的重要工具，允许用户通过图形界面方便地设计和实现各种类型的二阶滤波器。通过调整不同的参数，用户可以实现所需的频率响应，以满足音频处理的需求。

#### 计算公式
#滤波
基于Robert Bristow-Johnson设计的双二阶滤波器来进行实现的，双二阶滤波器的实现基于以下这个传递函数
![[Pasted image 20240801150649.png]]

反离散傅里叶变化后时域数据后的计算如下:
y[n] = (b0/a0)\*x[n] + (b1/a0)\*x[n-1] + (b2/a0)\*x[n-2]- (a1/a0)\*y[n-1] - (a2/a0)\*y[n-2]

对于ADAU的操作中常用变量的操作如下:
![[Pasted image 20240801151353.png]]
![[Pasted image 20240801151435.png]]
对于滤波器中的常见参数如下
Q-->定义增益带宽 只，boost 或cut 频带范围,对于双二阶的低通或者高通滤波来说，
BW-->在octaves中的带宽(BPF/notch的-3db频率范围  或者 peak 的dBgain/2 的频率范围)
S-->shelf slop 参数，只有shelving eq 用的到
A =sqrt(pow(10.0,dBgain/20)) = pow(10.0,dBgain/40)//shelving 和peak filter 会用到
w0 = 2\*pi\*f0/fs
    alpha = sin(w0)/(2*Q)                                       (case: Q)
          = sin(w0)*sinh( ln(2)/2 * BW * w0/sin(w0) )           (case: BW)
          = sin(w0)/2 * sqrt( (A + 1/A)*(1/S - 1) + 2 )         (case: S)
Q BW S 之间的关系是
``` C
FYI: The relationship between bandwidth and Q is 
	1/Q = 2*sinh(ln(2)/2*BW*w0/sin(w0))     
	(digital filter w BLT)
or   1/Q = 2*sinh(ln(2)/2*BW)             
	(analog filter prototype)
 The relationship between shelf slope and Q is
	1/Q = sqrt((A + 1/A)*(1/S - 1) + 2)
 
    2*sqrt(A)*alpha  =  sin(w0) * sqrt( (A^2 + 1)*(1/S - 1) + 2*A )
        is a handy intermediate variable for shelving EQ filters.
```



![[Pasted image 20240801150614.png]]
Note that the b0 and b2 coefficients for the high pass filter below are inverted from what is stored in RAM. The correct equations for b0, b1, and b2 for a high pass filter are as follows:  
b0 = -(1 + cos(ω0)) * gainLinear / 2  
b1 = -(1 + cos(ω0)) * gainLinear  
b2 = -(1 + cos(ω0)) * gainLinear / 2
![[Pasted image 20240801154557.png]]
![[Pasted image 20240801154611.png]]



