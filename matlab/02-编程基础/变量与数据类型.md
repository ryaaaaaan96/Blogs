# MATLAB变量与数据类型

## 📋 概述

MATLAB是一种动态类型语言，变量不需要预先声明类型。理解MATLAB的数据类型和变量操作是编程的基础，本文将全面介绍MATLAB中的变量概念、数据类型以及相关操作。

## 🔧 变量基础

### 变量命名规则

```matlab
% 有效的变量名
x = 5;                  % 简单变量
my_variable = 10;       % 下划线分隔
data2023 = [1,2,3];     % 数字结尾
Temperature = 25.5;     % 大小写敏感

% 无效的变量名示例（注释掉的代码）
% 2var = 5;            % 不能以数字开头
% my-var = 10;         % 不能包含连字符
% class = 20;          % 不能使用保留字

% 检查变量是否存在
if exist('x', 'var')
    fprintf('变量 x 存在，值为: %.2f\n', x);
end

% 变量名长度限制
long_variable_name_that_is_very_descriptive = 42;
fprintf('最大变量名长度: %d字符\n', namelengthmax);
```

### 变量操作

```matlab
% 查看工作空间变量
who                     % 显示变量名
whos                    % 显示详细信息

% 清除变量
clear x                 % 清除特定变量
clear all              % 清除所有变量（不推荐）
clearvars              % 推荐的清除所有变量方法

% 变量类型查询
a = 5;
b = 'hello';
c = [1,2,3];

fprintf('a的类型: %s\n', class(a));
fprintf('b的类型: %s\n', class(b));
fprintf('c的类型: %s\n', class(c));

% 变量大小和内存
fprintf('a的大小: %s\n', mat2str(size(a)));
fprintf('c占用内存: %d字节\n', whos('c').bytes);
```

## 📊 数值数据类型

### 浮点数类型

```matlab
% 双精度浮点数（默认）
d = 3.14159;            % double类型
fprintf('双精度: %.15f\n', d);
fprintf('类型: %s, 字节: %d\n', class(d), sizeof(d));

% 单精度浮点数
s = single(3.14159);
fprintf('单精度: %.15f\n', s);
fprintf('类型: %s, 字节: %d\n', class(s), sizeof(s));

% 精度比较
difference = double(s) - d;
fprintf('精度差异: %.20f\n', difference);

% 特殊数值
special_values = {
    inf, 'inf', '正无穷';
    -inf, '-inf', '负无穷';
    NaN, 'NaN', '非数字';
    0, '0', '零';
    eps, 'eps', '机器精度'
};

fprintf('\n特殊数值:\n');
for i = 1:size(special_values, 1)
    value = special_values{i, 1};
    name = special_values{i, 2};
    description = special_values{i, 3};
    fprintf('%s = %.15e (%s)\n', name, value, description);
end

% 数值范围
fprintf('\n数值范围:\n');
fprintf('双精度最大值: %.3e\n', realmax);
fprintf('双精度最小值: %.3e\n', realmin);
fprintf('单精度最大值: %.3e\n', realmax('single'));
fprintf('单精度最小值: %.3e\n', realmin('single'));
```

### 整数类型

```matlab
% 不同精度的整数类型
int8_val = int8(127);          % 8位有符号整数
uint8_val = uint8(255);        % 8位无符号整数
int16_val = int16(32767);      % 16位有符号整数
uint16_val = uint16(65535);    % 16位无符号整数
int32_val = int32(2147483647); % 32位有符号整数
uint32_val = uint32(4294967295); % 32位无符号整数

% 显示整数信息
integer_types = {int8_val, 'int8'; uint8_val, 'uint8'; 
                int16_val, 'int16'; uint16_val, 'uint16';
                int32_val, 'int32'; uint32_val, 'uint32'};

fprintf('整数类型演示:\n');
for i = 1:size(integer_types, 1)
    val = integer_types{i, 1};
    type_name = integer_types{i, 2};
    fprintf('%s: %d (范围: %d 到 %d)\n', type_name, val, ...
            intmin(type_name), intmax(type_name));
end

% 整数溢出处理
overflow_demo = uint8(250) + uint8(10);
fprintf('\n溢出演示: uint8(250) + uint8(10) = %d\n', overflow_demo);

% 类型转换
double_val = 3.7;
int_converted = int32(double_val);
fprintf('类型转换: %.1f -> %d\n', double_val, int_converted);
```

## 📝 字符与字符串

### 字符数组

```matlab
% 字符数组创建
char1 = 'Hello';                    % 字符数组
char2 = ['Hello', ' ', 'World'];    % 拼接字符数组
char3 = char('Line1', 'Line2');     % 多行字符数组

fprintf('字符数组:\n');
fprintf('char1: %s (类型: %s)\n', char1, class(char1));
fprintf('char2: %s\n', char2);
fprintf('char3大小: %s\n', mat2str(size(char3)));

% 字符数组操作
char_length = length(char1);
char_size = size(char1);
fprintf('字符长度: %d, 大小: %s\n', char_length, mat2str(char_size));

% 字符比较和查找
search_char = 'l';
positions = find(char1 == search_char);
fprintf('字符 ''%s'' 在位置: %s\n', search_char, mat2str(positions));
```

### 字符串数组（R2016b+）

```matlab
% 字符串数组创建（新版MATLAB）
str1 = "Hello World";              % 字符串标量
str2 = ["Apple", "Banana", "Cherry"]; % 字符串数组
str3 = string({'Red', 'Green', 'Blue'}); % 从cell转换

fprintf('\n字符串数组:\n');
fprintf('str1: %s (类型: %s)\n', str1, class(str1));
fprintf('str2: ');
disp(str2);

% 字符串操作
str_length = strlength(str1);
str_upper = upper(str1);
str_lower = lower(str1);

fprintf('字符串长度: %d\n', str_length);
fprintf('大写: %s\n', str_upper);
fprintf('小写: %s\n', str_lower);

% 字符串拼接
concatenated = str1 + " " + "from MATLAB";
fprintf('拼接结果: %s\n', concatenated);

% 字符串替换和分割
replaced = replace(str1, "World", "MATLAB");
split_result = split(str1, " ");
fprintf('替换结果: %s\n', replaced);
fprintf('分割结果: ');
disp(split_result);
```

### 字符串与字符数组转换

```matlab
% 类型转换
char_array = 'MATLAB Programming';
string_from_char = string(char_array);
char_from_string = char(string_from_char);

fprintf('\n类型转换:\n');
fprintf('原字符数组: %s (类型: %s)\n', char_array, class(char_array));
fprintf('转为字符串: %s (类型: %s)\n', string_from_char, class(string_from_char));
fprintf('转回字符数组: %s (类型: %s)\n', char_from_string, class(char_from_string));

% 格式化字符串
name = "MATLAB";
version = 2023;
formatted = sprintf("软件: %s, 版本: %d", name, version);
fprintf('格式化字符串: %s\n', formatted);
```

## 🏗️ 复合数据类型

### cell数组

```matlab
% cell数组创建
cell1 = {1, 'hello', [1,2,3]};      % 混合类型cell
cell2 = cell(2, 3);                  % 预分配cell数组
cell3 = {'apple', 'banana'; 123, [1,2,3,4]};

fprintf('Cell数组演示:\n');
fprintf('cell1内容: %d, %s, [%s]\n', cell1{1}, cell1{2}, num2str(cell1{3}));

% cell数组操作
cell_size = size(cell3);
fprintf('cell3大小: %d x %d\n', cell_size(1), cell_size(2));

% 访问cell内容
for i = 1:numel(cell1)
    content = cell1{i};
    fprintf('cell1{%d}: %s (类型: %s)\n', i, ...
            string(mat2str(content)), class(content));
end

% cell数组应用：存储不同长度的数据
data_sets = {rand(1,5), rand(1,3), rand(1,8)};
fprintf('\n不同长度数据集:\n');
for i = 1:length(data_sets)
    fprintf('数据集%d (长度%d): [%s]\n', i, length(data_sets{i}), ...
            num2str(data_sets{i}, '%.2f '));
end
```

### 结构体

```matlab
% 结构体创建
student.name = 'Zhang San';
student.age = 20;
student.grades = [85, 92, 78, 90];

% 多个结构体
students(1).name = 'Li Si';
students(1).age = 21;
students(1).grades = [88, 85, 92];

students(2).name = 'Wang Wu';
students(2).age = 19;
students(2).grades = [75, 80, 85, 90];

fprintf('结构体演示:\n');
fprintf('学生姓名: %s, 年龄: %d\n', student.name, student.age);
fprintf('平均成绩: %.2f\n', mean(student.grades));

% 结构体数组操作
fprintf('\n学生信息:\n');
for i = 1:length(students)
    fprintf('%d. %s (年龄: %d, 平均分: %.1f)\n', ...
            i, students(i).name, students(i).age, mean(students(i).grades));
end

% 结构体函数
field_names = fieldnames(student);
fprintf('\n结构体字段: %s\n', strjoin(field_names, ', '));

% 动态字段名
field_name = 'email';
student.(field_name) = 'zhangsan@email.com';
fprintf('动态添加字段 %s: %s\n', field_name, student.(field_name));
```

### 表格（table）类型

```matlab
% 创建表格
names = {'Alice', 'Bob', 'Charlie', 'Diana'}';
ages = [25; 30; 35; 28];
salaries = [50000; 60000; 75000; 55000];
departments = {'IT', 'HR', 'Finance', 'IT'}';

employee_table = table(names, ages, salaries, departments, ...
                      'VariableNames', {'Name', 'Age', 'Salary', 'Department'});

fprintf('表格演示:\n');
disp(employee_table);

% 表格操作
fprintf('\n表格统计:\n');
fprintf('平均年龄: %.1f\n', mean(employee_table.Age));
fprintf('平均工资: %.0f\n', mean(employee_table.Salary));

% 筛选数据
it_employees = employee_table(strcmp(employee_table.Department, 'IT'), :);
fprintf('\nIT部门员工:\n');
disp(it_employees);

% 添加新列
employee_table.Bonus = employee_table.Salary * 0.1;
fprintf('\n添加奖金列后:\n');
disp(employee_table(:, {'Name', 'Salary', 'Bonus'}));
```

## 🔄 类型检查与转换

### 类型检查函数

```matlab
% 创建不同类型的变量
test_vars = {
    42, 'double数值';
    'hello', '字符数组';
    "world", '字符串';
    [1,2,3], '数值数组';
    {1,'a'}, 'cell数组';
    struct('a',1), '结构体';
    true, '逻辑值'
};

fprintf('类型检查演示:\n');
for i = 1:size(test_vars, 1)
    var = test_vars{i, 1};
    description = test_vars{i, 2};
    
    fprintf('%s:\n', description);
    fprintf('  class: %s\n', class(var));
    fprintf('  isnumeric: %d\n', isnumeric(var));
    fprintf('  ischar: %d\n', ischar(var));
    fprintf('  isstring: %d\n', isstring(var));
    fprintf('  iscell: %d\n', iscell(var));
    fprintf('  isstruct: %d\n', isstruct(var));
    fprintf('  islogical: %d\n', islogical(var));
    fprintf('\n');
end
```

### 类型转换

```matlab
% 数值类型转换
original = 3.14159;
converted_types = {
    int32(original), 'int32';
    uint8(original), 'uint8';
    single(original), 'single';
    logical(original), 'logical'
};

fprintf('数值类型转换 (原值: %.5f):\n', original);
for i = 1:size(converted_types, 1)
    value = converted_types{i, 1};
    type_name = converted_types{i, 2};
    fprintf('  %s: %s\n', type_name, mat2str(value));
end

% 字符串转换
str_number = "123.45";
num_from_str = str2double(str_number);
fprintf('\n字符串到数值: "%s" -> %.2f\n', str_number, num_from_str);

% 数值到字符串
num_value = 987.654;
str_from_num = num2str(num_value, '%.2f');
fprintf('数值到字符串: %.3f -> "%s"\n', num_value, str_from_num);

% 安全转换（错误处理）
invalid_str = "not_a_number";
safe_conversion = str2double(invalid_str);
if isnan(safe_conversion)
    fprintf('转换失败: "%s" 不是有效数字\n', invalid_str);
end
```

## 📈 变量内存管理

### 内存使用监控

```matlab
% 创建大型变量
large_matrix = rand(1000, 1000);
large_cell = cell(100, 100);

% 检查内存使用
memory_info = whos;
total_memory = sum([memory_info.bytes]);

fprintf('内存使用情况:\n');
for i = 1:length(memory_info)
    var_info = memory_info(i);
    fprintf('  %s: %d字节 (%.2f MB)\n', var_info.name, ...
            var_info.bytes, var_info.bytes/1024/1024);
end
fprintf('总内存使用: %.2f MB\n', total_memory/1024/1024);

% 清理内存
clear large_matrix large_cell;
fprintf('清理后，大型变量已删除\n');
```

### 变量持久化

```matlab
% 保存变量到文件
save_data.numbers = [1, 2, 3, 4, 5];
save_data.text = 'MATLAB数据';
save_data.matrix = magic(3);

% 保存到.mat文件
save('data_backup.mat', 'save_data');
fprintf('数据已保存到 data_backup.mat\n');

% 清除变量
clear save_data;

% 从文件加载
load('data_backup.mat');
fprintf('数据已从文件加载:\n');
fprintf('  numbers: [%s]\n', num2str(save_data.numbers));
fprintf('  text: %s\n', save_data.text);
fprintf('  matrix:\n');
disp(save_data.matrix);

% 清理临时文件
delete('data_backup.mat');
fprintf('临时文件已删除\n');
```

## 🎯 最佳实践

### 编程规范

```matlab
% 1. 变量命名规范
student_count = 30;          % 使用描述性名称
max_temperature = 35.5;      % 使用下划线分隔
is_valid = true;            % 布尔变量用is_前缀

% 2. 预分配内存（推荐）
n = 1000;
data_preallocated = zeros(n, 1);    % 预分配
for i = 1:n
    data_preallocated(i) = rand();
end

% 3. 避免循环中改变数组大小（不推荐的做法，仅作演示）
% data_growing = [];
% for i = 1:100
%     data_growing = [data_growing, rand()];  % 每次都重新分配内存
% end

% 4. 使用适当的数据类型
image_data = uint8(255 * rand(100, 100));  % 图像用uint8
flags = false(10, 1);                      % 标志用logical

fprintf('编程最佳实践:\n');
fprintf('1. 使用描述性变量名\n');
fprintf('2. 预分配内存提高性能\n');
fprintf('3. 选择合适的数据类型\n');
fprintf('4. 定期清理不需要的变量\n');
```

### 性能优化示例

```matlab
% 性能比较：预分配 vs 动态增长
n = 10000;

% 方法1: 预分配（推荐）
tic;
data_fast = zeros(n, 1);
for i = 1:n
    data_fast(i) = i^2;
end
time_preallocated = toc;

% 方法2: 动态增长（不推荐）
tic;
data_slow = [];
for i = 1:n
    data_slow(end+1) = i^2;
end
time_dynamic = toc;

fprintf('\n性能比较 (n=%d):\n', n);
fprintf('预分配方法: %.4f秒\n', time_preallocated);
fprintf('动态增长方法: %.4f秒\n', time_dynamic);
fprintf('性能提升: %.1f倍\n', time_dynamic / time_preallocated);
```

---

> **变量与数据类型总结**：MATLAB提供了丰富的数据类型来满足不同的编程需求。理解各种数据类型的特点和适用场景，正确使用类型转换函数，遵循良好的编程规范，是写出高效MATLAB代码的基础。
