# 矩阵与数组操作

## 📋 概述

矩阵是MATLAB的核心数据结构，MATLAB的名称就来源于"Matrix Laboratory"（矩阵实验室）。掌握矩阵和数组的创建、操作和运算是学习MATLAB的基础。本章将深入介绍MATLAB中矩阵和数组的各种操作方法。

## 🔢 矩阵创建

### 基本创建方法

```matlab
% 1. 直接输入法
A = [1, 2, 3; 4, 5, 6; 7, 8, 9];    % 3×3矩阵
B = [1 2 3; 4 5 6];                  % 2×3矩阵，逗号可省略
C = [1; 2; 3];                       % 列向量
D = [1, 2, 3];                       % 行向量

% 2. 范围创建法
x = 1:5;                             % [1, 2, 3, 4, 5]
y = 1:0.5:3;                         % [1, 1.5, 2, 2.5, 3]
z = 10:-1:5;                         % [10, 9, 8, 7, 6, 5]

% 3. linspace函数 - 创建等间距向量
t = linspace(0, 10, 5);              % 0到10之间5个等间距点
% 结果: [0, 2.5, 5, 7.5, 10]

% 4. logspace函数 - 创建对数等间距向量
log_vec = logspace(1, 3, 3);         % 10^1到10^3之间3个对数等间距点
% 结果: [10, 100, 1000]
```

### 特殊矩阵创建

```matlab
% 零矩阵
Z1 = zeros(3);                       % 3×3零矩阵
Z2 = zeros(2, 4);                    % 2×4零矩阵
Z3 = zeros(size(A));                 % 与A同大小的零矩阵

% 全1矩阵
O1 = ones(3);                        % 3×3全1矩阵
O2 = ones(2, 3);                     % 2×3全1矩阵

% 单位矩阵
I1 = eye(3);                         % 3×3单位矩阵
I2 = eye(2, 4);                      % 2×4矩阵，对角线为1

% 对角矩阵
D1 = diag([1, 2, 3]);               % 对角线为[1,2,3]的对角矩阵
D2 = diag([1, 2, 3], 1);            % 上对角线为[1,2,3]
D3 = diag([1, 2, 3], -1);           % 下对角线为[1,2,3]

% 随机矩阵
R1 = rand(3);                        % 3×3均匀分布随机矩阵 [0,1]
R2 = randn(2, 4);                    % 2×4正态分布随机矩阵
R3 = randi([1, 10], 3, 3);          % 3×3随机整数矩阵 [1,10]

% 魔方矩阵
M = magic(3);                        % 3×3魔方矩阵（行、列、对角线和相等）
% 结果: [8 1 6; 3 5 7; 4 9 2]

% 希尔伯特矩阵
H = hilb(4);                         % 4×4希尔伯特矩阵

% 常数矩阵
C = 5 * ones(2, 3);                  % 2×3全5矩阵
```

### 复杂矩阵创建

```matlab
% 块矩阵组合
A = [1, 2; 3, 4];
B = [5, 6; 7, 8];
C = [A, B; B, A];                    % 块矩阵
% 结果: [1 2 5 6; 3 4 7 8; 5 6 1 2; 7 8 3 4]

% 重复矩阵
rep1 = repmat(A, 2, 3);              % 将A重复2行3列
rep2 = repmat([1, 2], 3, 1);         % 将[1,2]重复3行1列

% 条件创建
n = 5;
condition_matrix = (rand(n) > 0.5);  % 随机逻辑矩阵

% 网格矩阵
[X, Y] = meshgrid(1:3, 1:4);        % 创建网格坐标矩阵
% X = [1 2 3; 1 2 3; 1 2 3; 1 2 3]
% Y = [1 1 1; 2 2 2; 3 3 3; 4 4 4]
```

## 🎯 矩阵索引与访问

### 基本索引

```matlab
A = [1, 2, 3, 4; 5, 6, 7, 8; 9, 10, 11, 12];

% 单元素访问
element = A(2, 3);                   % 第2行第3列: 7
A(1, 1) = 100;                      % 修改第1行第1列为100

% 行列访问
row2 = A(2, :);                     % 第2行所有元素: [5, 6, 7, 8]
col3 = A(:, 3);                     % 第3列所有元素: [3; 7; 11]

% 多行多列访问
submatrix = A(1:2, 2:4);            % 子矩阵: 第1-2行，第2-4列
rows = A([1, 3], :);                % 第1行和第3行
cols = A(:, [2, 4]);                % 第2列和第4列

% 条件索引
large_elements = A(A > 7);          % 所有大于7的元素
A(A < 5) = 0;                       % 将小于5的元素设为0
```

### 高级索引

```matlab
% 线性索引
A = reshape(1:12, 3, 4);            % 3×4矩阵
element = A(5);                     % 线性索引第5个元素 (按列计数)

% 逻辑索引
logical_mask = A > 6;               % 逻辑矩阵
selected = A(logical_mask);         % 提取满足条件的元素

% find函数
[row, col] = find(A > 8);           % 找到大于8的元素位置
indices = find(A > 8);              % 线性索引

% 端点索引
last_element = A(end);              % 最后一个元素
last_row = A(end, :);               % 最后一行
second_last = A(end-1, end-1);      % 倒数第二行倒数第二列
```

### 索引技巧

```matlab
% 反向索引
reversed_A = A(end:-1:1, :);        % 行反转
reversed_cols = A(:, end:-1:1);     % 列反转

% 随机索引
random_rows = A(randperm(size(A,1)), :);  % 随机打乱行

% 循环索引
circular_shift = A([2:end, 1], :);  % 行循环移位

% 空索引删除
A(2, :) = [];                       % 删除第2行
A(:, [1, 3]) = [];                  % 删除第1列和第3列
```

## ⚙️ 矩阵运算

### 算术运算

```matlab
A = [1, 2; 3, 4];
B = [5, 6; 7, 8];

% 矩阵加减法
C = A + B;                          % 矩阵加法: [6, 8; 10, 12]
D = A - B;                          % 矩阵减法: [-4, -4; -4, -4]

% 矩阵乘法
E = A * B;                          % 矩阵乘法: [19, 22; 43, 50]
F = A * B';                         % A乘以B的转置

% 逐元素运算
G = A .* B;                         % 逐元素乘法: [5, 12; 21, 32]
H = A ./ B;                         % 逐元素除法: [0.2, 0.33; 0.43, 0.5]
I = A .^ B;                         % 逐元素幂运算: [1, 64; 2187, 65536]

% 标量运算
J = A + 5;                          % 每个元素加5
K = 2 * A;                          % 每个元素乘2
L = A / 2;                          % 每个元素除以2
```

### 矩阵函数

```matlab
% 基本矩阵函数
A = [1, 2, 3; 4, 5, 6; 7, 8, 9];

% 转置
A_transpose = A';                   % 转置矩阵
A_conj_transpose = A';              % 共轭转置（对实矩阵等同于转置）

% 行列式和逆矩阵
det_A = det(A);                     % 行列式 (注意：A奇异，det=0)
% inv_A = inv(A);                   % 逆矩阵（A奇异时会出错）
pinv_A = pinv(A);                   % 伪逆矩阵

% 秩和迹
rank_A = rank(A);                   % 矩阵的秩: 2
trace_A = trace(A);                 % 矩阵的迹: 15

% 范数
norm_A = norm(A);                   % 矩阵的2-范数
norm_A_1 = norm(A, 1);              % 1-范数
norm_A_inf = norm(A, inf);          % 无穷范数
norm_A_fro = norm(A, 'fro');        % Frobenius范数
```

### 特征值和特征向量

```matlab
% 对称矩阵示例
S = [4, 1, 1; 1, 4, 1; 1, 1, 4];

% 特征值和特征向量
[V, D] = eig(S);                    % V为特征向量矩阵，D为特征值对角矩阵
eigenvalues = diag(D);              % 提取特征值
[sorted_eig, idx] = sort(eigenvalues, 'descend'); % 按降序排序

% 条件数
cond_S = cond(S);                   % 条件数

% 奇异值分解
[U, S_svd, V_svd] = svd(A);         % 奇异值分解
singular_values = diag(S_svd);      % 奇异值
```

## 📊 矩阵操作函数

### 形状操作

```matlab
A = [1, 2, 3, 4, 5, 6];

% 重塑
B = reshape(A, 2, 3);               % 重塑为2×3矩阵: [1, 3, 5; 2, 4, 6]
C = reshape(A, 3, 2);               % 重塑为3×2矩阵

% 尺寸信息
[m, n] = size(B);                   % 获取行数和列数
total_elements = numel(B);          % 总元素个数
matrix_size = size(B);              % 尺寸向量: [2, 3]
is_vector = isvector(A);            % 判断是否为向量
is_matrix = ismatrix(B);            % 判断是否为矩阵

% 维度操作
squeezed = squeeze(rand(1, 3, 4));  % 删除单维
permuted = permute(rand(2,3,4), [3,1,2]); % 维度置换
```

### 排序和搜索

```matlab
data = [3, 1, 4, 1, 5, 9, 2, 6];

% 排序
sorted_data = sort(data);           % 升序排序: [1, 1, 2, 3, 4, 5, 6, 9]
[sorted_desc, idx_desc] = sort(data, 'descend'); % 降序排序及索引

% 矩阵排序
matrix_data = [3, 1, 4; 1, 5, 9; 2, 6, 5];
sorted_rows = sort(matrix_data, 2); % 按行排序
sorted_cols = sort(matrix_data, 1); % 按列排序

% 搜索
[found, pos] = ismember(5, data);   % 查找元素5的位置
unique_vals = unique(data);         % 去重: [1, 2, 3, 4, 5, 6, 9]
[unique_vals, ia, ic] = unique(data); % 包含索引信息

% 最值
max_val = max(data);                % 最大值: 9
[max_val, max_idx] = max(data);     % 最大值及其位置
min_val = min(data);                % 最小值: 1
```

### 统计函数

```matlab
data_matrix = [1, 4, 7; 2, 5, 8; 3, 6, 9];

% 基本统计
mean_val = mean(data_matrix);       % 列均值: [2, 5, 8]
mean_row = mean(data_matrix, 2);    % 行均值: [4; 5; 6]
median_val = median(data_matrix);   % 列中位数
std_val = std(data_matrix);         % 列标准差
var_val = var(data_matrix);         % 列方差

% 累积统计
cumsum_val = cumsum(data_matrix);   % 列累积和
cumprod_val = cumprod(data_matrix); % 列累积积
cummax_val = cummax(data_matrix);   % 列累积最大值

% 相关性
correlation = corr(data_matrix);    % 相关系数矩阵
covariance = cov(data_matrix);      % 协方差矩阵
```

## 🔄 数组操作

### 多维数组

```matlab
% 创建3D数组
array_3d = rand(3, 4, 5);          % 3×4×5三维数组
array_3d_zeros = zeros(2, 3, 4);   % 3D零数组

% 访问3D数组
page1 = array_3d(:, :, 1);         % 第1页
element = array_3d(2, 3, 4);       % 特定元素
slice = array_3d(1, :, :);         % 第1行的所有页

% 操作3D数组
concatenated = cat(3, array_3d, array_3d); % 沿第3维连接
sum_pages = sum(array_3d, 3);      % 沿第3维求和
```

### 元胞数组

```matlab
% 创建元胞数组
cell_array = cell(2, 3);           % 2×3空元胞数组
mixed_cell = {1, 'hello', [1,2,3]; true, @sin, eye(2)};

% 访问元胞数组
content = mixed_cell{1, 2};         % 获取内容: 'hello'
mixed_cell{2, 1} = false;          % 修改内容

% 元胞数组函数
cell_fun = @(x) x^2;
numbers = {1, 2, 3, 4};
squared = cellfun(cell_fun, numbers); % 对每个元胞应用函数
```

### 结构数组

```matlab
% 创建结构数组
student.name = 'Alice';
student.age = 20;
student.grades = [85, 90, 78];

% 结构数组
students(1) = struct('name', 'Alice', 'age', 20, 'grades', [85, 90, 78]);
students(2) = struct('name', 'Bob', 'age', 19, 'grades', [92, 88, 95]);

% 访问结构数组
alice_grades = students(1).grades;
all_names = {students.name};        % 提取所有姓名

% 字段操作
field_names = fieldnames(students); % 获取字段名
has_age = isfield(students, 'age'); % 检查字段是否存在
students = rmfield(students, 'age'); % 删除字段
```

## 🧮 实际应用示例

### 图像处理基础

```matlab
% 创建简单图像
image_size = 100;
[X, Y] = meshgrid(1:image_size, 1:image_size);

% 创建同心圆图像
center_x = image_size/2;
center_y = image_size/2;
radius = sqrt((X - center_x).^2 + (Y - center_y).^2);
circle_image = radius < image_size/4;

% 显示图像
figure;
subplot(1,2,1);
imagesc(radius);
title('距离矩阵');
colorbar;

subplot(1,2,2);
imagesc(circle_image);
title('圆形图像');
colormap(gray);
```

### 数据分析实例

```matlab
% 模拟股票数据
days = 1:252;                       % 一年交易日
initial_price = 100;
returns = 0.001 + 0.02 * randn(size(days)); % 随机收益率
prices = initial_price * cumprod(1 + returns);

% 计算移动平均
window_size = 20;
moving_avg = movmean(prices, window_size);

% 分析统计特性
daily_return = diff(prices) ./ prices(1:end-1);
volatility = std(daily_return) * sqrt(252); % 年化波动率
max_drawdown = min(cummin(prices) ./ prices - 1);

% 可视化结果
figure;
subplot(2,1,1);
plot(days, prices, 'b-', days, moving_avg, 'r-', 'LineWidth', 1.5);
title('股价走势');
legend('价格', '20日移动平均', 'Location', 'best');
grid on;

subplot(2,1,2);
histogram(daily_return, 50);
title('日收益率分布');
xlabel('收益率');
ylabel('频次');
grid on;

fprintf('年化波动率: %.2f%%\n', volatility * 100);
fprintf('最大回撤: %.2f%%\n', max_drawdown * 100);
```

### 线性代数求解

```matlab
% 求解线性方程组 Ax = b
A = [2, 1, -1; -3, -1, 2; -2, 1, 2];
b = [8; -11; -3];

% 多种求解方法
x1 = A \ b;                         % 直接求解（推荐）
x2 = inv(A) * b;                    % 矩阵求逆（不推荐）
x3 = pinv(A) * b;                   % 伪逆求解

% 验证解
residual = A * x1 - b;              % 残差
fprintf('解: x = [%.2f, %.2f, %.2f]\n', x1);
fprintf('残差范数: %.2e\n', norm(residual));

% 条件数分析
condition_number = cond(A);
if condition_number > 1e12
    warning('矩阵接近奇异，解可能不准确');
else
    fprintf('条件数: %.2e (良好)\n', condition_number);
end
```

## 💡 性能优化技巧

### 向量化编程

```matlab
% 避免循环的向量化示例
n = 1000000;

% 低效方法：使用循环
tic;
result1 = zeros(1, n);
for i = 1:n
    result1(i) = sin(i/1000) + cos(i/1000);
end
time1 = toc;

% 高效方法：向量化
tic;
i = 1:n;
result2 = sin(i/1000) + cos(i/1000);
time2 = toc;

fprintf('循环方法耗时: %.4f秒\n', time1);
fprintf('向量化方法耗时: %.4f秒\n', time2);
fprintf('向量化速度提升: %.1f倍\n', time1/time2);
```

### 内存优化

```matlab
% 预分配内存
n = 10000;

% 低效方法：动态增长
tic;
data_bad = [];
for i = 1:n
    data_bad(end+1) = i^2;          % 每次都重新分配内存
end
time_bad = toc;

% 高效方法：预分配
tic;
data_good = zeros(1, n);            % 预分配内存
for i = 1:n
    data_good(i) = i^2;
end
time_good = toc;

fprintf('动态增长耗时: %.4f秒\n', time_bad);
fprintf('预分配耗时: %.4f秒\n', time_good);
fprintf('预分配速度提升: %.1f倍\n', time_bad/time_good);
```

## 🔍 调试和错误处理

### 常见错误

```matlab
% 1. 维度不匹配
try
    A = [1, 2; 3, 4];               % 2×2矩阵
    B = [1; 2; 3];                  % 3×1矩阵
    C = A + B;                      % 错误：维度不匹配
catch ME
    fprintf('错误: %s\n', ME.message);
end

% 2. 索引超出范围
try
    A = [1, 2, 3];
    element = A(5);                 % 错误：索引超出范围
catch ME
    fprintf('错误: %s\n', ME.message);
end

% 3. 奇异矩阵求逆
try
    singular_matrix = [1, 2; 2, 4]; % 奇异矩阵
    inv_matrix = inv(singular_matrix); % 警告或错误
catch ME
    fprintf('错误: %s\n', ME.message);
end
```

### 调试技巧

```matlab
% 检查矩阵属性
function matrix_info(A)
    fprintf('矩阵信息:\n');
    fprintf('大小: %dx%d\n', size(A, 1), size(A, 2));
    fprintf('元素个数: %d\n', numel(A));
    fprintf('数据类型: %s\n', class(A));
    fprintf('是否为空: %s\n', string(isempty(A)));
    fprintf('是否包含NaN: %s\n', string(any(isnan(A(:)))));
    fprintf('是否包含Inf: %s\n', string(any(isinf(A(:)))));
    fprintf('秩: %d\n', rank(A));
    fprintf('条件数: %.2e\n', cond(A));
end

% 示例使用
A = [1, 2, 3; 4, 5, 6; 7, 8, 9];
matrix_info(A);
```

---

> **矩阵操作总结**：矩阵是MATLAB的核心，掌握矩阵的创建、索引、运算和操作是学习MATLAB的基础。记住要善用向量化编程提高效率，注意内存预分配，并学会调试矩阵相关的错误。
