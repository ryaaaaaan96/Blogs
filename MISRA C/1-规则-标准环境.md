# C语言标准环境

## 1.1程序不得违反标准 C 语法和约束，且不得超出实现的翻译限制

- 必须

程序应仅使用所选版本的 C 标准（如 C90 或 C99）中规定的语言特性和库功能（见文档 3.1 节）。
允许使用编译器提供的语言扩展，但需确保扩展不改变严格合规程序的行为。

### 禁止行为

除使用语言扩展的情况外，程序不得违反 C 标准中的语法规则或约束。
不得超出编译器的翻译限制（如最大标识符长度、嵌套深度等）。C 标准规定了最低限制，编译器可提供更高限制。

### 编译器诊断

合规的编译器会对语法和约束违规生成诊断信息（可能是警告而非错误），但即使存在违规，编译器仍可能生成可执行文件。
若超出翻译限制，编译器可能不生成诊断信息，且生成的可执行文件行为不保证正确。

## 1.2尽量不要使用编译器所提供的扩展

- 建议

若必须使用语言扩展，需在项目设计文档中明确说明使用理由，并记录确保扩展正确使用的方法（如编译器诊断检查）。

扩展不得改变严格符合 C 标准的程序的行为（例如，不得修改逻辑运算符的短路求值特性）。

## 1.3程序中不得出现未定义行为或关键未指定行为

- 必须

未定义行为（Undefined Behaviour）：C 标准未规定结果的行为，可能导致程序崩溃、数据损坏或不可预测输出（如访问越界数组、空指针解引用），必须完全规避。

关键未指定行为（Critical Unspecified Behaviour）：C 标准未明确规定但可能影响程序正确性的行为（如函数参数评估顺序），需通过规则限制使用场景以确保一致性。

***未定义行为***

| 行为描述 | 关联规则 | 标准参考 |
| --- | --- | --- |
| 访问未初始化的自动变量 | Rule 9.1 | C90 [Undefined 41], C99 [Undefined 10, 17] |
| 数组越界访问 | Rule 18.1 | C90 [Undefined 32], C99 [Undefined 48] |
| 空指针解引用 | Rule 17.6 | C90 [Undefined 19], C99 [Undefined 42] |
| 移除指针的const或volatile限定符 | Rule 11.8 | C90 [Undefined 39], C99 [Undefined 61] |
| 函数调用时参数类型与声明不匹配 | Rule 8.2, Rule 17.3 | C90 [Undefined 22–25], C99 [Undefined 36–39] |
| 无返回值的非void函数被调用并使用返回值 | Rule 17.4 | C90 [Undefined 43], C99 [Undefined 82] |
| 自增 / 自减运算符在同一表达式中多次修改同一对象 | Rule 13.2 | C90 [Undefined 18], C99 [Undefined 32] |
| 移位操作的右操作数为负数或大于等于左操作数宽度 | Rule 12.2 | C90 [Undefined 32], C99 [Undefined 48] |
| 使用goto跳转到变量初始化语句之前 | Rule 15.3 | C99 [Undefined 9] |
| 动态内存释放后再次访问或释放 | Rule 22.2 | C90 [Undefined 92], C99 [Undefined 169] |

***关键未指定行为***

| 行为描述 | 关联规则 | 标准参考 | |  |
| --- | --- | --- | --- | --- |
| 函数参数的评估顺序 | Rule 13.2 | C90 [Unspecified 7–9], C99 [Unspecified 15–18] | | |
| 逻辑运算符（&&/||）的右操作数是否执行 | Rule 13.5 | C90 [Unspecified 8], C99 [Unspecified 16] |
| 结构体成员的内存布局（填充和对齐） | - | C90 [Unspecified 13], C99 [Unspecified 10] | | |
| 枚举类型的底层整数类型大小 | Rule 10.1 | C90 [Implementation 29], C99 [Implementation J.3.9] | | |
| 字符串字面量的存储位置（是否共享） | Rule 7.4 | C99 [Unspecified 14] | | |
| sizeof运算符对变长数组（VLA）的评估时机 | Rule 13.6 | C99 [Unspecified 21] | | |
| 复合赋值运算符的中间结果类型 | Rule 10.3 | C90 [Unspecified 23], C99 [Unspecified 13] | | |
