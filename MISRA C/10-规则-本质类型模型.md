# 本质类型模型

MISRA C引入了“本质类型（Essential Type）”的概念，用于在整数提升和类型转换规则之外，提供一个更严格的类型检查系统，以防止因类型不匹配而导致的常见编程错误。

## 规则 10.1：逻辑运算符的操作数应为“有效布尔型”

- 必须

`&&`、`||` 和 `!` 逻辑运算符的操作数应该是布尔类型（在C中通常用 `_Bool` 或等效的 `typedef`）。将非布尔类型（如 `int`）直接用于逻辑运算，可能会因为意外的数值（非0或1）而导致逻辑混乱和可读性下降。

## 规则 10.2：本质字符类型的表达式不应不恰当地用于加减运算

- 建议

本质上是字符的类型（如 `char`）不应与整数进行加减运算，除非是为了在同一字符数组内进行指针运算。将字符与整数混合运算通常是没有意义的，并且会降低代码清晰度。

## 表达式的值应与其赋值变量的本质类型一致

- 必须

赋值操作符（`=`、`+=` 等）两边的表达式应具有相同的本质类型。例如，不应将一个本质上是无符号整数的值赋给一个本质上是有符号整数的变量，这可能导致数据丢失或未定义行为。

## 规则 10.4：运算符的两个操作数应具有相同的本质类型类别

- 必须

对于二元运算符（如 `+`, `-`, `*`, `|`, `&`），两个操作数应属于相同的本质类型类别（如都是有符号整数，或都是浮点数）。混合不同类别的操作数会触发复杂的隐式类型转换，可能产生非预期的结果。

## 规则 10.5：一元 `+` 或 `-` 运算符的操作数应为有符号类型

- 必须

对一个无符号类型的操作数使用一元减号（`-`）会导致其值根据模运算规则回绕（wrap-around），结果仍然是一个大的正数，这几乎肯定不是程序员的本意。一元加号（`+`）虽然对无符号数无害，但为了保持一致性，此规则同样适用。

## 规则 10.6：`~` 运算符的操作数应为无符号类型

- 必须

按位取反（`~`）一个有符号整数的行为是实现定义的，因为它依赖于整数的内部表示（如二进制补码）。为了确保行为的可预测性和可移植性，`~` 操作符应只用于无符号整数。

## 规则 10.7：二元位运算的结果不应与操作数的本质类型不同

- 建议

位运算符（`&`, `|`, `^`）的结果应被存储在与操作数本质类型相同的变量中。将其赋给一个不同本质类型的变量（例如，将两个 `unsigned char` 的位运算结果赋给 `unsigned int`）可能表明代码逻辑中存在类型混淆。

## 规则 10.8：移位运算的结果不应与左操作数的本质类型不同

- 必须

移位操作（`<<`, `>>`）的结果应被视为与左操作数具有相同的本质类型。将其赋给一个不同本质类型的变量可能会丢失位信息或导致意外的类型转换。
