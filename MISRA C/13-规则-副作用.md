# 副作用

副作用是指在计算表达式时，对状态（如变量的值或文件）产生的修改。C语言对副作用何时发生有严格的规定，违反这些规定会导致未定义行为。

## 规则 13.1：初始化表达式不应包含不确定的副作用

- 建议

在对象初始化时，如果初始化表达式包含多个子表达式且它们都带有副作用，那么这些副作用的发生顺序是未指定的。依赖于特定顺序的代码是不可移植的。

## 规则 13.2：在两个序列点之间，一个对象的值最多只能被修改一次

- 必须

这是C语言中一条非常重要的规则。如果在一个表达式中，同一个变量被修改了多次而没有序列点分隔（例如 `i = i++;`），其行为是未定义的。这会导致程序在不同编译器或优化级别下产生完全不同的结果。

## 规则 13.3：表达式的结果值不应依赖于子表达式的求值顺序

- 建议

即使没有违反“修改一次”的规则，如果表达式的最终结果依赖于子表达式的求值顺序，这样的代码也是不可靠的。例如 `a[i] = i++;`，数组索引 `i` 和右侧的 `i++` 哪个先求值是未指定的。

## 规则 13.4：赋值运算符的结果不应在表达式中被使用

- 建议

赋值操作（如 `x = y`）本身会产生一个值（即赋给 `x` 的值）。在更复杂的表达式中使用这个值（例如 `if ((x = y) != 0)`）虽然在C中是合法的，但容易与比较操作 `==` 混淆，降低代码可读性，并可能引入错误。建议将赋值和比较分开写。

## 规则 13.5：`for` 循环的第二个和第三个表达式不应包含持久的副作用

- 建议

在 `for (init; condition; increment)` 循环中，`condition` 和 `increment` 表达式中的副作用应该只影响循环本身。如果它们修改了循环外部也能访问的变量（持久副作用），会使循环的行为难以理解和维护。

## 规则 13.6：`sizeof` 运算符的操作数不应包含副作用

- 必须

`sizeof` 的操作数（除非是变长数组）是不会被求值的。因此，任何在 `sizeof` 操作数中的副作用（如函数调用 `sizeof(my_func())` 或自增 `sizeof(x++)`）都不会发生，这违反了程序员的预期，必须禁止。
